<div class="min-h-screen bg-linear-to-br from-purple-900 via-blue-900 to-indigo-900">
  <app-header title="Reports & Analytics" [showBackButton]="true"></app-header>

  <div class="p-4 md:p-8">
  <div class="max-w-7xl mx-auto">
    <!-- Tabs -->
    <div class="mb-6 flex flex-wrap gap-2">
      <button
        (click)="setActiveTab('daily')"
        [class.bg-white/30]="activeTab() === 'daily'"
        [class.bg-white/10]="activeTab() !== 'daily'"
        class="px-6 py-3 rounded-lg text-white font-semibold backdrop-blur-md border border-white/20 hover:bg-white/20 transition-all">
        Daily Revenue
      </button>
      <button
        (click)="setActiveTab('breakdown')"
        [class.bg-white/30]="activeTab() === 'breakdown'"
        [class.bg-white/10]="activeTab() !== 'breakdown'"
        class="px-6 py-3 rounded-lg text-white font-semibold backdrop-blur-md border border-white/20 hover:bg-white/20 transition-all">
        Revenue Breakdown
      </button>
      <button
        (click)="setActiveTab('zreport')"
        [class.bg-white/30]="activeTab() === 'zreport'"
        [class.bg-white/10]="activeTab() !== 'zreport'"
        class="px-6 py-3 rounded-lg text-white font-semibold backdrop-blur-md border border-white/20 hover:bg-white/20 transition-all">
        Z-Report
      </button>
      <button
        (click)="setActiveTab('backup')"
        [class.bg-white/30]="activeTab() === 'backup'"
        [class.bg-white/10]="activeTab() !== 'backup'"
        class="px-6 py-3 rounded-lg text-white font-semibold backdrop-blur-md border border-white/20 hover:bg-white/20 transition-all">
        Backup & Restore
      </button>
    </div>

    <!-- Messages -->
    @if (error()) {
      <div class="mb-6 backdrop-blur-md bg-red-500/20 border border-red-500/50 rounded-xl p-4">
        <p class="text-white font-semibold">{{ error() }}</p>
      </div>
    }
    @if (success()) {
      <div class="mb-6 backdrop-blur-md bg-green-500/20 border border-green-500/50 rounded-xl p-4">
        <p class="text-white font-semibold">{{ success() }}</p>
      </div>
    }

    <!-- Loading Spinner -->
    @if (loading()) {
      <div class="mb-6 backdrop-blur-md bg-white/10 rounded-xl p-8 border border-white/20 text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-white"></div>
        <p class="text-white mt-4">Loading...</p>
      </div>
    }

    <!-- Daily Revenue Tab -->
    @if (activeTab() === 'daily' && !loading()) {
      <div class="backdrop-blur-md bg-white/10 rounded-2xl p-6 border border-white/20">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-white">Today's Revenue</h2>
          <button
            (click)="loadDailyRevenue()"
            class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-all">
            Refresh
          </button>
        </div>

        @if (dailyRevenue()) {
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="backdrop-blur-md bg-white/10 rounded-xl p-6 border border-white/20">
              <p class="text-white/70 text-sm mb-2">Total Revenue</p>
              <p class="text-3xl font-bold text-white">{{ formatCurrency(dailyRevenue()!.totalRevenue) }}</p>
            </div>
            <div class="backdrop-blur-md bg-white/10 rounded-xl p-6 border border-white/20">
              <p class="text-white/70 text-sm mb-2">Total Orders</p>
              <p class="text-3xl font-bold text-white">{{ dailyRevenue()!.totalOrders }}</p>
            </div>
            <div class="backdrop-blur-md bg-white/10 rounded-xl p-6 border border-white/20">
              <p class="text-white/70 text-sm mb-2">Average Order Value</p>
              <p class="text-3xl font-bold text-white">{{ formatCurrency(dailyRevenue()!.averageOrderValue) }}</p>
            </div>
          </div>

          <div class="mt-6">
            <button
              (click)="exportOrders()"
              class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold transition-all">
              Export Orders to CSV
            </button>
          </div>
        }
      </div>
    }

    <!-- Revenue Breakdown Tab -->
    @if (activeTab() === 'breakdown' && !loading()) {
      <div class="backdrop-blur-md bg-white/10 rounded-2xl p-6 border border-white/20">
        <h2 class="text-2xl font-bold text-white mb-6">Revenue by Order Type</h2>

        <div class="mb-6 grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-white mb-2">Start Date</label>
            <input
              type="datetime-local"
              [(ngModel)]="startDate"
              class="w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white backdrop-blur-md">
          </div>
          <div>
            <label class="block text-white mb-2">End Date</label>
            <input
              type="datetime-local"
              [(ngModel)]="endDate"
              class="w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white backdrop-blur-md">
          </div>
        </div>

        <div class="mb-6">
          <button
            (click)="loadRevenueByType()"
            class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-all mr-4">
            Generate Report
          </button>
          <button
            (click)="exportRevenueReport()"
            class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold transition-all">
            Export to CSV
          </button>
        </div>

        @if (revenueByType().length > 0) {
          <div class="overflow-x-auto">
            <table class="w-full text-left">
              <thead>
                <tr class="border-b border-white/20">
                  <th class="px-4 py-3 text-white font-semibold">Order Type</th>
                  <th class="px-4 py-3 text-white font-semibold">Revenue</th>
                  <th class="px-4 py-3 text-white font-semibold">Order Count</th>
                </tr>
              </thead>
              <tbody>
                @for (item of revenueByType(); track item.orderType) {
                  <tr class="border-b border-white/10">
                    <td class="px-4 py-3 text-white">{{ item.orderType }}</td>
                    <td class="px-4 py-3 text-white font-bold">{{ formatCurrency(item.revenue) }}</td>
                    <td class="px-4 py-3 text-white">{{ item.orderCount }}</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        }
      </div>
    }

    <!-- Z-Report Tab -->
    @if (activeTab() === 'zreport' && !loading()) {
      <div class="backdrop-blur-md bg-white/10 rounded-2xl p-6 border border-white/20">
        <h2 class="text-2xl font-bold text-white mb-6">Z-Report (End of Day)</h2>

        <div class="mb-6 grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-white mb-2">Start Date</label>
            <input
              type="datetime-local"
              [(ngModel)]="startDate"
              class="w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white backdrop-blur-md">
          </div>
          <div>
            <label class="block text-white mb-2">End Date</label>
            <input
              type="datetime-local"
              [(ngModel)]="endDate"
              class="w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white backdrop-blur-md">
          </div>
        </div>

        <div class="mb-6">
          <button
            (click)="loadZReport()"
            class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-all mr-4">
            Generate Z-Report
          </button>
          <button
            (click)="exportZReport()"
            class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold transition-all">
            Export to CSV
          </button>
        </div>

        @if (zReport()) {
          <div class="space-y-6">
            <!-- Summary -->
            <div class="backdrop-blur-md bg-white/5 rounded-xl p-6 border border-white/10">
              <h3 class="text-xl font-bold text-white mb-4">Summary</h3>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div>
                  <p class="text-white/70 text-sm">Total Orders</p>
                  <p class="text-2xl font-bold text-white">{{ zReport()!.totalOrders }}</p>
                </div>
                <div>
                  <p class="text-white/70 text-sm">Total Revenue</p>
                  <p class="text-2xl font-bold text-white">{{ formatCurrency(zReport()!.totalRevenue) }}</p>
                </div>
                <div>
                  <p class="text-white/70 text-sm">Avg Order Value</p>
                  <p class="text-2xl font-bold text-white">{{ formatCurrency(zReport()!.averageOrderValue) }}</p>
                </div>
                <div>
                  <p class="text-white/70 text-sm">Items Sold</p>
                  <p class="text-2xl font-bold text-white">{{ zReport()!.itemsSold }}</p>
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4 mt-4">
                <div>
                  <p class="text-white/70 text-sm">VAT Collected</p>
                  <p class="text-xl font-bold text-white">{{ formatCurrency(zReport()!.totalVAT) }}</p>
                </div>
                <div>
                  <p class="text-white/70 text-sm">Tips Collected</p>
                  <p class="text-xl font-bold text-white">{{ formatCurrency(zReport()!.totalTips) }}</p>
                </div>
              </div>
            </div>

            <!-- Revenue by Type -->
            <div class="backdrop-blur-md bg-white/5 rounded-xl p-6 border border-white/10">
              <h3 class="text-xl font-bold text-white mb-4">Revenue by Order Type</h3>
              <div class="overflow-x-auto">
                <table class="w-full text-left">
                  <thead>
                    <tr class="border-b border-white/20">
                      <th class="px-4 py-2 text-white">Type</th>
                      <th class="px-4 py-2 text-white">Revenue</th>
                      <th class="px-4 py-2 text-white">Orders</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (item of zReport()!.revenueByType; track item.orderType) {
                      <tr class="border-b border-white/10">
                        <td class="px-4 py-2 text-white">{{ item.orderType }}</td>
                        <td class="px-4 py-2 text-white font-bold">{{ formatCurrency(item.revenue) }}</td>
                        <td class="px-4 py-2 text-white">{{ item.orderCount }}</td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Orders by Status -->
            <div class="backdrop-blur-md bg-white/5 rounded-xl p-6 border border-white/10">
              <h3 class="text-xl font-bold text-white mb-4">Orders by Status</h3>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                @for (item of zReport()!.ordersByStatus; track item.status) {
                  <div class="backdrop-blur-md bg-white/5 rounded-lg p-4 border border-white/10">
                    <p class="text-white/70 text-sm">{{ item.status }}</p>
                    <p class="text-2xl font-bold text-white">{{ item.count }}</p>
                  </div>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }

    <!-- Backup & Restore Tab -->
    @if (activeTab() === 'backup' && !loading()) {
      <div class="backdrop-blur-md bg-white/10 rounded-2xl p-6 border border-white/20">
        <h2 class="text-2xl font-bold text-white mb-6">Backup & Restore</h2>

        <div class="space-y-6">
          <!-- Create Backup -->
          <div class="backdrop-blur-md bg-white/5 rounded-xl p-6 border border-white/10">
            <h3 class="text-xl font-semibold text-white mb-3">Create Backup</h3>
            <p class="text-white/70 mb-4">Export all database data to a JSON file for backup purposes.</p>
            <button
              (click)="createBackup()"
              class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-all">
              Download Backup
            </button>
          </div>

          <!-- Restore Backup -->
          <div class="backdrop-blur-md bg-white/5 rounded-xl p-6 border border-white/10">
            <h3 class="text-xl font-semibold text-white mb-3">Restore Backup</h3>
            <p class="text-white/70 mb-4">Import data from a backup file. This will add data to your current database.</p>
            <div class="flex items-center gap-4">
              <label class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold transition-all cursor-pointer">
                Choose Backup File
                <input
                  type="file"
                  accept=".json"
                  (change)="restoreBackup($event)"
                  class="hidden">
              </label>
            </div>
          </div>

          <!-- Warning -->
          <div class="backdrop-blur-md bg-yellow-500/20 border border-yellow-500/50 rounded-xl p-4">
            <p class="text-white font-semibold">⚠️ Important Notes:</p>
            <ul class="text-white/80 mt-2 space-y-1 list-disc list-inside">
              <li>Backups contain all your business data</li>
              <li>Store backups in a secure location</li>
              <li>Test your backups regularly</li>
              <li>Restoring will add data to your current database</li>
            </ul>
          </div>
        </div>
      </div>
    }
  </div>
</div>
